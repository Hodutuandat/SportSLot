{% extends 'base.html' %}
{% block title %}S√¢n c·ªßa t√¥i | SportSlot Owner{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/owner/dashboard.css') }}">
<link rel="stylesheet" href="{{ url_for('static', filename='css/owner/my_fields.css') }}">
{% endblock %}

{% block content %}
<div class="owner-fields-container">
        <!-- Header -->
        <header class="main-header">
            <div class="header-content">
                <h1>S√¢n c·ªßa t√¥i</h1>
                <div class="header-actions">
                    <a href="{{ url_for('owner.add_field') }}" class="add-field-btn">
                        <span class="btn-icon">‚ûï</span>
                        Th√™m s√¢n m·ªõi
                    </a>
                </div>
            </div>
        </header>

        <!-- Fields Content -->
        <div class="fields-content">
            <!-- Stats Overview -->
            <div class="fields-stats">
                <div class="stat-item">
                    <div class="stat-number">{{ fields|length }}</div>
                    <div class="stat-label">T·ªïng s·ªë s√¢n</div>
                </div>
                <div class="stat-item">
                    <div class="stat-number">{{ fields|selectattr("status", "equalto", "active")|list|length }}</div>
                    <div class="stat-label">ƒêang ho·∫°t ƒë·ªông</div>
                </div>
                <div class="stat-item">
                    <div class="stat-number">{{ (fields|sum(attribute='total_bookings') / fields|length)|round(0)|int if fields else 0 }}</div>
                    <div class="stat-label">Booking TB/s√¢n</div>
                </div>
                <div class="stat-item">
                    <div class="stat-number">{{ "{:,.0f}".format(fields|sum(attribute='monthly_revenue')) }}ƒë</div>
                    <div class="stat-label">Doanh thu th√°ng</div>
                </div>
            </div>

            <!-- Fields Grid -->
            <div class="fields-grid">
                {% for field in fields %}
                <div class="field-card" data-field-id="{{ field.id }}">
                    <div class="field-header">
                        <div class="field-image">
                            {% if field.image %}
                                <img src="{{ field.image }}" alt="{{ field.name }}">
                            {% else %}
                                <div class="field-placeholder">
                                    <span class="sport-icon">
                                        {% if field.sport_type == 'football' %}‚öΩ
                                        {% elif field.sport_type == 'basketball' %}üèÄ
                                        {% elif field.sport_type == 'tennis' %}üéæ
                                        {% elif field.sport_type == 'volleyball' %}üèê
                                        {% elif field.sport_type == 'badminton' %}üè∏
                                        {% else %}üèüÔ∏è{% endif %}
                                    </span>
                                </div>
                            {% endif %}
                        </div>
                        <div class="field-status {{ field.status }}">
                            {% if field.status == 'active' %}‚úÖ Ho·∫°t ƒë·ªông
                            {% else %}‚è∏Ô∏è T·∫°m d·ª´ng{% endif %}
                        </div>
                    </div>
                    
                    <div class="field-info">
                        <h3 class="field-name">{{ field.name }}</h3>
                        <p class="field-type">{{ field.type }}</p>
                        <p class="field-address">üìç {{ field.address }}</p>
                        
                        <div class="field-stats">
                            <div class="field-stat">
                                <span class="stat-value">{{ "{:,.0f}".format(field.price) }}ƒë</span>
                                <span class="stat-label">Gi√°/gi·ªù</span>
                            </div>
                            <div class="field-stat">
                                <span class="stat-value">{{ field.total_bookings }}</span>
                                <span class="stat-label">L∆∞·ª£t ƒë·∫∑t</span>
                            </div>
                            <div class="field-stat">
                                <span class="stat-value">{{ "{:,.0f}".format(field.monthly_revenue) }}ƒë</span>
                                <span class="stat-label">Doanh thu</span>
                            </div>
                        </div>
                        
                        <div class="field-actions">
                            <button class="action-btn edit-btn" data-field-id="{{ field.id }}">
                                Ch·ªânh s·ª≠a
                            </button>
                            <button class="action-btn view-bookings-btn" data-field-id="{{ field.id }}">
                                L·ªãch ƒë·∫∑t
                            </button>
                            <button class="action-btn toggle-status-btn" data-field-id="{{ field.id }}" data-status="{{ field.status }}">
                                <span class="btn-icon">{% if field.status == 'active' %}‚è∏Ô∏è{% else %}‚ñ∂Ô∏è{% endif %}</span>
                                {% if field.status == 'active' %}T·∫°m d·ª´ng{% else %}K√≠ch ho·∫°t{% endif %}
                            </button>
                        </div>
                    </div>
                </div>
                {% else %}
                <div class="empty-state">
                    <div class="empty-icon">üèüÔ∏è</div>
                    <h3>Ch∆∞a c√≥ s√¢n n√†o</h3>
                    <p>H√£y th√™m s√¢n ƒë·∫ßu ti√™n c·ªßa b·∫°n ƒë·ªÉ b·∫Øt ƒë·∫ßu kinh doanh</p>
                    <a href="{{ url_for('owner.add_field') }}" class="add-first-field-btn">
                        <span class="btn-icon">‚ûï</span>
                        Th√™m s√¢n ƒë·∫ßu ti√™n
                    </a>
                </div>
                {% endfor %}
            </div>
        </div>
</div>

<!-- Booking Modal -->
<div id="bookingModal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h3>L·ªãch ƒë·∫∑t s√¢n</h3>
            <button class="close-btn" onclick="closeModal()">&times;</button>
        </div>
        <div class="modal-body">
            <div id="bookingCalendar">
                <!-- Calendar will be populated by JavaScript -->
            </div>
        </div>
    </div>
</div>

<!-- Edit Field Modal -->
<div id="editFieldModal" class="modal">
    <div class="modal-content edit-field-modal">
        <div class="modal-header">
            <h3>Ch·ªânh s·ª≠a s√¢n</h3>
            <button class="close-btn" onclick="closeEditModal()">&times;</button>
        </div>
        <div class="modal-body">
            <form id="editFieldForm" class="edit-field-form">
                <div class="form-section">
                    <h4>Th√¥ng tin c∆° b·∫£n</h4>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="editFieldName">T√™n s√¢n *</label>
                            <input type="text" id="editFieldName" name="fieldName" required>
                        </div>
                        <div class="form-group">
                            <label for="editFieldType">Lo·∫°i s√¢n *</label>
                            <select id="editFieldType" name="fieldType" required>
                                <option value="football">B√≥ng ƒë√°</option>
                                <option value="basketball">B√≥ng r·ªï</option>
                                <option value="tennis">Tennis</option>
                                <option value="badminton">C·∫ßu l√¥ng</option>
                                <option value="volleyball">B√≥ng chuy·ªÅn</option>
                                <option value="futsal">Futsal</option>
                                <option value="ping-pong">Ping Pong</option>
                                <option value="other">Kh√°c</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="editFieldDescription">M√¥ t·∫£</label>
                        <textarea id="editFieldDescription" name="fieldDescription" rows="3" placeholder="M√¥ t·∫£ chi ti·∫øt v·ªÅ s√¢n..."></textarea>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="editCapacity">S·ª©c ch·ª©a</label>
                            <input type="number" id="editCapacity" name="capacity" min="1" placeholder="S·ªë ng∆∞·ªùi t·ªëi ƒëa">
                        </div>
                        <div class="form-group">
                            <label for="editFieldSize">K√≠ch th∆∞·ªõc s√¢n</label>
                            <input type="text" id="editFieldSize" name="fieldSize" placeholder="VD: 40m x 20m">
                        </div>
                    </div>
                </div>

                <div class="form-section">
                    <h4>ƒê·ªãa ch·ªâ</h4>
                    <div class="form-group">
                        <label for="editAddress">ƒê·ªãa ch·ªâ chi ti·∫øt *</label>
                        <input type="text" id="editAddress" name="address" required>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="editDistrict">Qu·∫≠n/Huy·ªán *</label>
                            <input type="text" id="editDistrict" name="district" required>
                        </div>
                        <div class="form-group">
                            <label for="editCity">Th√†nh ph·ªë *</label>
                            <input type="text" id="editCity" name="city" required>
                        </div>
                    </div>
                </div>

                <div class="form-section">
                    <h4>Ti·ªán √≠ch</h4>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="editParking">B√£i ƒë·ªó xe</label>
                            <select id="editParking" name="parking">
                                <option value="free">Mi·ªÖn ph√≠</option>
                                <option value="paid">C√≥ ph√≠</option>
                                <option value="none">Kh√¥ng c√≥</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="editTransportation">Giao th√¥ng</label>
                            <select id="editTransportation" name="transportation">
                                <option value="bus">Xe bu√Ωt</option>
                                <option value="metro">T√†u ƒëi·ªán</option>
                                <option value="taxi">Taxi</option>
                                <option value="motorbike">Xe m√°y</option>
                                <option value="car">√î t√¥</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label>Ti·ªán √≠ch kh√°c</label>
                        <div class="checkbox-group">
                            <label class="checkbox-item">
                                <input type="checkbox" name="amenities" value="lighting">
                                <span class="checkmark"></span>
                                ƒê√®n chi·∫øu s√°ng
                            </label>
                            <label class="checkbox-item">
                                <input type="checkbox" name="amenities" value="changing_room">
                                <span class="checkmark"></span>
                                Ph√≤ng thay ƒë·ªì
                            </label>
                            <label class="checkbox-item">
                                <input type="checkbox" name="amenities" value="shower">
                                <span class="checkmark"></span>
                                V√≤i t·∫Øm
                            </label>
                            <label class="checkbox-item">
                                <input type="checkbox" name="amenities" value="equipment">
                                <span class="checkmark"></span>
                                Trang thi·∫øt b·ªã
                            </label>
                            <label class="checkbox-item">
                                <input type="checkbox" name="amenities" value="cafe">
                                <span class="checkmark"></span>
                                Qu√°n cafe
                            </label>
                            <label class="checkbox-item">
                                <input type="checkbox" name="amenities" value="wifi">
                                <span class="checkmark"></span>
                                WiFi
                            </label>
                        </div>
                    </div>
                </div>

                <div class="form-section">
                    <h4>Gi√° c·∫£</h4>
                    <div class="pricing-grid">
                        <div class="pricing-header">
                            <div class="time-slot">Khung gi·ªù</div>
                            <div class="weekday">Ng√†y th∆∞·ªùng</div>
                            <div class="weekend">Cu·ªëi tu·∫ßn</div>
                        </div>
                        
                        <div class="pricing-row">
                            <div class="time-slot">S√°ng (05:00-12:00)</div>
                            <div class="weekday">
                                <input type="number" name="morning_weekday" placeholder="VNƒê" min="0">
                            </div>
                            <div class="weekend">
                                <input type="number" name="morning_weekend" placeholder="VNƒê" min="0">
                            </div>
                        </div>
                        
                        <div class="pricing-row">
                            <div class="time-slot">Tr∆∞a (12:00-17:00)</div>
                            <div class="weekday">
                                <input type="number" name="afternoon_weekday" placeholder="VNƒê" min="0">
                            </div>
                            <div class="weekend">
                                <input type="number" name="afternoon_weekend" placeholder="VNƒê" min="0">
                            </div>
                        </div>
                        
                        <div class="pricing-row">
                            <div class="time-slot">T·ªëi (17:00-23:00)</div>
                            <div class="weekday">
                                <input type="number" name="evening_weekday" placeholder="VNƒê" min="0">
                            </div>
                            <div class="weekend">
                                <input type="number" name="evening_weekend" placeholder="VNƒê" min="0">
                            </div>
                        </div>
                    </div>
                </div>

                <div class="form-section">
                    <h4>Gi·ªù ho·∫°t ƒë·ªông</h4>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="editWeekdayStart">Ng√†y th∆∞·ªùng - B·∫Øt ƒë·∫ßu</label>
                            <input type="time" id="editWeekdayStart" name="weekday_start">
                        </div>
                        <div class="form-group">
                            <label for="editWeekdayEnd">Ng√†y th∆∞·ªùng - K·∫øt th√∫c</label>
                            <input type="time" id="editWeekdayEnd" name="weekday_end">
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="editWeekendStart">Cu·ªëi tu·∫ßn - B·∫Øt ƒë·∫ßu</label>
                            <input type="time" id="editWeekendStart" name="weekend_start">
                        </div>
                        <div class="form-group">
                            <label for="editWeekendEnd">Cu·ªëi tu·∫ßn - K·∫øt th√∫c</label>
                            <input type="time" id="editWeekendEnd" name="weekend_end">
                        </div>
                    </div>
                </div>

                <div class="form-section">
                    <h4>Ch√≠nh s√°ch</h4>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="editDeposit">ƒê·∫∑t c·ªçc</label>
                            <input type="number" id="editDeposit" name="deposit" placeholder="VNƒê" min="0">
                        </div>
                        <div class="form-group">
                            <label for="editCancellation">H·ªßy ƒë·∫∑t s√¢n</label>
                            <select id="editCancellation" name="cancellation">
                                <option value="free">Mi·ªÖn ph√≠</option>
                                <option value="partial">M·ªôt ph·∫ßn</option>
                                <option value="full">To√†n b·ªô</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="editRules">Quy ƒë·ªãnh s·ª≠ d·ª•ng</label>
                        <textarea id="editRules" name="rules" rows="3" placeholder="C√°c quy ƒë·ªãnh khi s·ª≠ d·ª•ng s√¢n..."></textarea>
                    </div>
                </div>
            </form>
        </div>
        <div class="modal-footer">
            <button class="btn secondary" onclick="closeEditModal()">H·ªßy</button>
            <button class="btn primary" onclick="saveFieldChanges()">L∆∞u thay ƒë·ªïi</button>
        </div>
    </div>
</div>

<!-- Confirmation Modal -->
<div id="confirmModal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h3>X√°c nh·∫≠n</h3>
            <button class="close-btn" onclick="closeConfirmModal()">&times;</button>
        </div>
        <div class="modal-body">
            <p id="confirmMessage"></p>
            <div class="modal-actions">
                <button class="action-btn cancel-btn" onclick="closeConfirmModal()">H·ªßy</button>
                <button class="action-btn confirm-btn" id="confirmBtn">X√°c nh·∫≠n</button>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script src="{{ url_for('static', filename='js/owner/my_fields.js') }}"></script>
{% endblock %} 