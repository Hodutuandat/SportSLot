{% extends 'base.html' %}
{% block title %}Th√¥ng b√°o | SportSlot Owner{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/owner/notification.css') }}">
{% endblock %}

{% block content %}
<div class="notification-page">
    <!-- Header -->
    <div class="notification-header">
        <div class="header-left">
            <h1>Th√¥ng b√°o</h1>
            <p class="header-subtitle">Qu·∫£n l√Ω t·∫•t c·∫£ th√¥ng b√°o h·ªá th·ªëng</p>
        </div>
        <div class="header-actions">
            <button class="btn btn-secondary" onclick="markAllRead()">
                <span class="btn-icon">‚úì</span>
                ƒê√°nh d·∫•u t·∫•t c·∫£ ƒë√£ ƒë·ªçc
            </button>
            <button class="btn btn-primary" onclick="refreshNotifications()">
                <span class="btn-icon">‚Üª</span>
                L√†m m·ªõi
            </button>
        </div>
    </div>

    <!-- Stats Cards -->
    <div class="notification-stats">
        <div class="stat-card">
            <div class="stat-icon total">üìä</div>
            <div class="stat-content">
                <div class="stat-number">{{ stats.total }}</div>
                <div class="stat-label">T·ªïng th√¥ng b√°o</div>
            </div>
        </div>
        
        <div class="stat-card">
            <div class="stat-icon unread">üîî</div>
            <div class="stat-content">
                <div class="stat-number">{{ stats.unread }}</div>
                <div class="stat-label">Ch∆∞a ƒë·ªçc</div>
            </div>
        </div>
        
        <div class="stat-card">
            <div class="stat-icon urgent">‚ö†Ô∏è</div>
            <div class="stat-content">
                <div class="stat-number">{{ stats.urgent }}</div>
                <div class="stat-label">C·∫ßn x·ª≠ l√Ω</div>
            </div>
        </div>
        
        <div class="stat-card">
            <div class="stat-icon booking">‚öΩ</div>
            <div class="stat-content">
                <div class="stat-number">{{ stats.by_type.booking }}</div>
                <div class="stat-label">Booking</div>
            </div>
        </div>
        
        <div class="stat-card">
            <div class="stat-icon payment">üí∞</div>
            <div class="stat-content">
                <div class="stat-number">{{ stats.by_type.payment }}</div>
                <div class="stat-label">Thanh to√°n</div>
            </div>
        </div>
        
        <div class="stat-card">
            <div class="stat-icon review">‚≠ê</div>
            <div class="stat-content">
                <div class="stat-number">{{ stats.by_type.review }}</div>
                <div class="stat-label">ƒê√°nh gi√°</div>
            </div>
        </div>
    </div>

    <!-- Filters and Search -->
    <div class="notification-controls">
        <div class="filter-section">
            <button class="filter-btn active" data-filter="all">
                T·∫•t c·∫£ <span class="filter-count">{{ stats.total }}</span>
            </button>
            <button class="filter-btn" data-filter="urgent">
                Kh·∫©n c·∫•p <span class="filter-count">{{ stats.urgent }}</span>
            </button>
            <button class="filter-btn" data-filter="booking">
                Booking <span class="filter-count">{{ stats.by_type.booking }}</span>
            </button>
            <button class="filter-btn" data-filter="payment">
                Thanh to√°n <span class="filter-count">{{ stats.by_type.payment }}</span>
            </button>
            <button class="filter-btn" data-filter="review">
                ƒê√°nh gi√° <span class="filter-count">{{ stats.by_type.review }}</span>
            </button>
            <button class="filter-btn" data-filter="report">
                B√°o c√°o <span class="filter-count">{{ stats.by_type.report }}</span>
            </button>
            <button class="filter-btn" data-filter="system">
                H·ªá th·ªëng <span class="filter-count">{{ stats.by_type.system }}</span>
            </button>
        </div>
        
        <div class="search-section">
            <div class="search-box">
                <input type="text" id="notificationSearch" placeholder="T√¨m ki·∫øm th√¥ng b√°o...">
                <span class="search-icon">üîç</span>
            </div>
        </div>
    </div>

    <!-- Notifications List -->
    <div class="notifications-container">
        <div class="notifications-list" id="notificationsList">
            {% for notification in notifications %}
            <div class="notification-item {{ 'unread' if not notification.read }} {{ notification.type }} {{ notification.subtype }}" 
                 data-id="{{ notification.id }}" 
                 data-type="{{ notification.type }}"
                 data-subtype="{{ notification.subtype }}">
                
                <div class="notification-icon">
                    {% if notification.type == 'booking' %}
                        {% if notification.subtype == 'urgent' %}‚ö†Ô∏è{% else %}üìÖ{% endif %}
                    {% elif notification.type == 'payment' %}
                        {% if notification.subtype == 'success' %}üí∞{% else %}‚ùå{% endif %}
                    {% elif notification.type == 'review' %}
                        {% if notification.subtype == 'positive' %}‚≠ê{% else %}üòû{% endif %}
                    {% elif notification.type == 'report' %}üìä
                    {% elif notification.type == 'system' %}‚úÖ
                    {% endif %}
                </div>
                
                <div class="notification-content">
                    <div class="notification-header">
                        <div class="notification-title">
                            <span class="type-badge {{ notification.type }}">{{ notification.type|title }}</span>
                            {% if notification.subtype == 'urgent' %}
                                <span class="urgent-badge">Kh·∫©n c·∫•p</span>
                            {% endif %}
                            {{ notification.title }}
                        </div>
                        <div class="notification-time">{{ notification.date }}</div>
                    </div>
                    
                    <div class="notification-message">{{ notification.message }}</div>
                    <div class="notification-details">{{ notification.details }}</div>
                    
                    {% if notification.action_required %}
                    <div class="notification-actions">
                        {% if notification.type == 'booking' and notification.subtype == 'urgent' %}
                            <button class="action-btn approve" onclick="approveBooking({{ notification.booking_id }})">
                                <span class="action-icon">‚úì</span> Duy·ªát
                            </button>
                            <button class="action-btn reject" onclick="rejectBooking({{ notification.booking_id }})">
                                <span class="action-icon">‚úï</span> T·ª´ ch·ªëi
                            </button>
                        {% elif notification.type == 'review' and notification.subtype == 'negative' %}
                            <button class="action-btn respond" onclick="respondToReview({{ notification.id }})">
                                <span class="action-icon">üí¨</span> Ph·∫£n h·ªìi
                            </button>
                        {% elif notification.type == 'payment' and notification.subtype == 'failed' %}
                            <button class="action-btn retry" onclick="retryPayment({{ notification.id }})">
                                <span class="action-icon">üîÑ</span> Th·ª≠ l·∫°i
                            </button>
                        {% elif notification.type == 'report' %}
                            <a href="{{ url_for('owner.transaction_history') }}" class="action-btn view-report">
                                <span class="action-icon">üìä</span> Xem b√°o c√°o
                            </a>
                        {% endif %}
                    </div>
                    {% endif %}
                </div>
                
                <div class="notification-status">
                    {% if not notification.read %}
                        <div class="unread-indicator"></div>
                    {% endif %}
                    <button class="status-btn" onclick="toggleNotificationStatus({{ notification.id }})">
                        {% if notification.read %}‚úì{% else %}‚óã{% endif %}
                    </button>
                </div>
            </div>
            {% endfor %}
        </div>
        
        <!-- Empty State -->
        <div class="empty-state" id="emptyState" style="display: none;">
            <div class="empty-icon">üîî</div>
            <h3>Kh√¥ng c√≥ th√¥ng b√°o n√†o</h3>
            <p>T·∫•t c·∫£ th√¥ng b√°o ƒë√£ ƒë∆∞·ª£c x·ª≠ l√Ω ho·∫∑c kh√¥ng c√≥ th√¥ng b√°o m·ªõi.</p>
        </div>
    </div>

    <!-- Load More -->
    <div class="load-more-section">
        <button class="load-more-btn" onclick="loadMoreNotifications()">
            <span class="load-more-icon">‚Üì</span>
            T·∫£i th√™m th√¥ng b√°o
        </button>
    </div>
</div>

<!-- Notification Detail Modal -->
<div class="notification-modal" id="notificationModal">
    <div class="modal-content">
        <div class="modal-header">
            <h3 id="modalTitle">Chi ti·∫øt th√¥ng b√°o</h3>
            <button class="modal-close" onclick="closeNotificationModal()">√ó</button>
        </div>
        <div class="modal-body" id="modalBody">
            <!-- Content will be loaded here -->
        </div>
        <div class="modal-footer">
            <button class="btn btn-secondary" onclick="closeNotificationModal()">ƒê√≥ng</button>
            <button class="btn btn-primary" id="modalActionBtn" style="display: none;">Th·ª±c hi·ªán</button>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script src="{{ url_for('static', filename='js/owner/notification.js') }}"></script>
{% endblock %} 